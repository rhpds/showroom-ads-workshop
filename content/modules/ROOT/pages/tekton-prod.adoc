= OpenShift Pipelines - Production Deployment
Red Hat Advanced Developer Suite: Enterprise Security and GitOps Promotion
:icons: font
:source-highlighter: rouge
:toc: macro
:toclevels: 1

== Learning Objectives

By the end of this workshop section, you will:

* **Understand** enterprise production deployment workflows and security requirements
* **Execute** a secure production release using automated GitOps promotion
* **Implement** enterprise-grade security validation using Enterprise Contract
* **Monitor** production deployment pipelines and validate security posture
* **Comprehend** the complete supply chain security model and business value

== Workshop Scenario: Enterprise Production Transformation

**Business Challenge:**
Traditional production deployments take 2-3 weeks with manual security reviews, creating bottlenecks during critical release periods.

**Solution Goal:**
Transform risky manual processes into confident automated workflows using Red Hat Advanced Developer Suite (RHADS).

**Expected Business Outcomes:**

* Production deployment time: 2-3 weeks 	 30 minutes
* Zero manual security reviews or bottlenecks
* Eliminate human error through automation
* Complete SOC 2 and PCI audit trails automatically

[NOTE]
====
The examples and commands in this workshop demonstrate enterprise production deployment capabilities* Adapt repository URLs, credentials, and configurations as needed for your specific setup.
====

== Activity 1: Triggering Production Deployment with Git Release

In this activity, you'll initiate an enterprise-grade production deployment by creating a Git release, demonstrating how manual processes transform into automated confidence.

=== Step 1: Access Your GitLab Repository

* Open your GitLab repository at: {gitlab_url}/development/qrks-tkn-{user}[qrks-tkn-{user}^,subs="attributes"]
* Log in using:
  * Username: `{gitlab_user}`
  * Password: `{gitlab_user_password}`

image::tekton-prod-1.png[]

=== Step 2: Create a GitLab Release

* Navigate to *Deploy > Releases > Create a new release*

image::tekton-prod-2.png[]

* Select an existing tag (e.g., `v1.0`) or create a new one
* Enter meaningful release notes describing the changes
* Click *Create release*

image::tekton-prod-3.png[]

[TIP]
====
**Business Impact:** This single Git release action triggers the entire enterprise-grade security validation pipeline automatically, replacing weeks of manual approval processes.
====

=== Step 3: Monitor Pipeline Activation

* Navigate to the `qrks-tkn-{user}` component in Red Hat Developer Hub
* Click the *CI* tab to view pipeline runs
* Look for a pipeline run labeled *promote-to-prod* and expand it to view details

image::tekton-prod-4.png[]

**What You've Accomplished:**
You've initiated an automated production pipeline that will perform enterprise security validation before allowing deployment to production.

== Activity 2: Understanding Pipeline Tasks

The production pipeline provides enterprise-grade security validation while eliminating manual bottlenecks* Let's examine each task in detail.

=== Task 1.1: extract-destination-image-tag

**Purpose:** Production image tag extraction from Git releases

This task extracts the Git tag from the GitLab Release and converts it to a production image tag, enabling:

* Production release coordination through GitLab Releases
* Complete audit trails for production deployments
* End-to-end traceability from release to production deployment

=== Task 1.2: gather-images-to-verify

**Purpose:** Production image selection and metadata generation

This task selects the production-ready image based on the Git tag and generates `images.json`, which:

* Ensures only production-validated images are considered for deployment
* Provides production deployment metadata for compliance
* Creates mapping between Git release and production container image

[NOTE]
====
This mapping between Git release and production image provides end-to-end traceability — we know exactly what release went into what production deployment.
====

**Sample `images.json` for production:**
[source,json,subs="attributes"]
----
{
  "components": [
    {
      "containerImage": "quay.tssc-quay/tssc/qrks-tkn-{user}:v1.0",
      "source": {
        "git": {
          "url": "{gitlab_url}/development/qrks-tkn-{user}",
          "revision": "v1.0"
        }
      }
    }
  ]
}
----

=== Task 2: verify-enterprise-contract

**Purpose:** Production security validation through Enterprise Contract

This step enforces production-grade security validations that protect your business and customers:

**Production Security Validations:**
* **Container image signature verification** using cryptographic signing
* **Software Bill of Materials (SBOM) validation** for production supply chain security
* **CVE scanning** to prevent production vulnerabilities
* **Production policy compliance** ensuring enterprise security standards
* **Provenance attestation** to verify production build integrity

**Production Business Value:**

* Production security validation: 2-3 weeks → Minutes
* Production risk prevention before customer exposure
* Production audit readiness for compliance
* Automatic production CVE scanning and policy enforcement

**Production Enterprise Impact:**

* Production incident prevention: Issues caught before customer exposure
* Production audit confidence: Complete compliance evidence
* Production deployment velocity: Minutes instead of weeks
* Production risk elimination: 100% consistent security enforcement

[IMPORTANT]
====
If any production security check fails, the pipeline halts* Only fully validated images proceed to production deployment.
====

**Production Technical Implementation:**

The Enterprise Contract CLI performs production validation:

[source,bash,subs="attributes"]
----
ec validate image \
  --image quay.tssc-quay/tssc/qrks-tkn-{user}:v1.0 \
  --policy production \
  --public-key k8s://openshift/trusted-keys \
  --output json
----

**Production validation output:**
[source,json]
----
{
  "successes": [
    "Production image is signed and verified with cosign",
    "Production SBOM (CycloneDX) is present",
    "Production provenance attestation matches source repo",
    "No production vulnerabilities found",
    "Production policy compliance verified"
  ],
  "failures": []
}
----

=== Task 3: copy-image

**Purpose:** Production image promotion with security designation

This task promotes the production-validated image with a production tag (e.g., `prod-v1.0`), ensuring:

* Only production-validated images receive production designation
* Production-grade security assurance
* No unauthorized images reach production deployment

**Production Technical Implementation:**

[source,bash,subs="attributes"]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/qrks-tkn-{user}:v1.0 \
  docker://quay.tssc-quay/tssc/qrks-tkn-{user}:prod-v1.0
----

[IMPORTANT]
====
This guarantees that only production-validated artifacts are promoted — no unauthorized images slip through to production.
====

=== Task 4: update-deployment

**Purpose:** Production GitOps deployment automation

This task ensures production-validated changes reach production automatically through GitOps, enabling:

* Production deployment immediately after validation completion
* Production configuration validation before customer exposure
* No manual production coordination needed
* Production success ensures customer satisfaction

[NOTE]
====
No manual production kubectl commands, no production YAML editing — the system automatically deploys to production based on Git* That's the production GitOps advantage.
====

**Production GitOps Implementation:**

The pipeline updates production deployment files automatically:

**Production `kustomization.yaml`:**
[source,yaml]
----
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
patchesStrategicMerge:
  - deployment-patch.yaml
----

**Production `deployment-patch.yaml`:**
[source,yaml,subs="attributes"]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: qrks-tkn-{user}
spec:
  template:
    spec:
      containers:
        - name: qrks-tkn-{user}
          image: quay.tssc-quay/tssc/qrks-tkn-{user}:prod-v1.0
----

**Production Git diff showing automatic update:**
[source,diff,subs="attributes"]
----
-          image: quay.tssc-quay/tssc/qrks-tkn-{user}:v1.0
+          image: quay.tssc-quay/tssc/qrks-tkn-{user}:prod-v1.0
----

== Activity 3: Understanding the Complete Production Pipeline

In this activity, you'll observe how validated images are promoted to production and automatically deployed using GitOps, creating a secure bridge from validation to customer value.

=== Step 1: Understand Image Promotion Process

**Pipeline Task:** `copy-image`

This represents an enterprise quality gate — only validated images earn the "prod-" designation, ensuring enterprise security compliance.

* Observe the `copy-image` task in the pipeline execution
* Note how the validated image is promoted with a production label

**Image Promotion Command:**
[source,bash,subs="attributes"]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/qrks-tkn-{user}:v1.0 \
  docker://quay.tssc-quay/tssc/qrks-tkn-{user}:prod-v1.0
----

**What This Accomplishes:**

* Creates a new tag prefixed with `prod-` (e.g., `prod-v1.0`) that clearly identifies the image as production-ready
* Ensures complete traceability — the exact source and validation steps that led to this image are known
* Only images that pass Enterprise Contract validation make it this far, preventing unsafe code deployment
* Signals to Argo CD that this image is ready for production deployment

=== Step 2: Examine GitOps Deployment Process

This step shows how the validated image is automatically deployed to production through GitOps, creating an automated bridge from security validation to customer value.

=== Understanding Traditional vs RHADS Deployment Approaches

**Traditional Production Deployment Risks:**

* Manual deployment steps prone to human error during critical releases
* Emergency changes bypass proper validation under pressure
* Inconsistent deployment processes across different teams
* Production changes without proper audit trails

**RHADS Business Benefits:**

* **Zero Manual Errors:** GitOps automation eliminates human deployment mistakes
* **100% Audit Trail:** Every production change tracked and traceable
* **Consistent Process:** Same deployment method for routine and emergency changes
* **Continuous Compliance:** All changes follow the same validated security process

=== Step 3: Observe GitOps Repository Updates

* Watch as the pipeline updates the GitOps repository automatically
* Understand how this triggers Argo CD for production deployment

**Updated Deployment Manifest:**
[source,yaml,subs="attributes"]
----
apiversion: apps/v1
kind: Deployment
metadata:
  name: qrks-tkn-{user}
spec:
  template:
    spec:
      containers:
        - name: qrks-tkn-{user}
          image: quay.tssc-quay/tssc/qrks-tkn-{user}:prod-v1.0
----

**File Location:** `overlays/prod/deployment-patch.yaml`

**Kustomization Configuration:**
[source,yaml]
----
apiversion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
patchesStrategicMerge:
  - deployment-patch.yaml
----

=== Step 4: Validate GitOps Deployment Process

**Automated Process Flow:**

* The container image reference in the production overlay is updated by this patch
* The patch is committed and pushed to the GitOps repository by OpenShift Pipelines
* Argo CD watches this repository and detects the change immediately
* Argo CD syncs the deployment to the production cluster automatically
* Only verified, tagged images are deployed by this process, maintaining full auditability

**Business Impact:**
* **Deployment Confidence:** Argo CD ensures exactly what was validated gets deployed
* **Risk Elimination:** No manual steps that could introduce errors during critical releases
* **Compliance Automation:** Production environment continuously reflects audited Git state
* **Operational Excellence:** Standardized deployment process across all services

[NOTE]
====
The GitOps overlay system ensures the production environment stays secure, compliant, and traceable while enabling rapid deployment of business-critical features.
====



== Workshop Summary and Reflection

=== What You Accomplished

Congratulations! You've successfully implemented an enterprise-grade production deployment pipeline and experienced the complete transformation from manual processes to automated confidence.

**Pipeline Tasks Summary:**

|===
| Phase | Purpose

| 1.1 extract-destination-image-tag
| Extracts the Git tag for production image naming* The Git tag becomes the image tag for production promotion.

| 1.2 gather-images-to-verify
| Selects the image based on the Git tag and generates `images.json` with complete metadata.

| 2 verify-enterprise-contract
| Validates signature, SBOM, provenance, CVEs, and policies — all enforced via the EC CLI.

| 3 copy-image
| Promotes the validated image with `prod-` designation (e.g., `prod-v1.0`).

| 4 update-deployment
| Updates `overlays/prod` to trigger Argo CD deployment to production.
|===

=== Key Business Transformations Achieved

You've demonstrated how enterprise security and business velocity reinforce each other:

**Measurable Business Impact:**
* **Production Release Time:** 2-3 weeks 	 30 minutes (99% reduction)
* **Security Compliance:** 100% automated with zero manual reviews
* **Competitive Advantage:** Deploy features while competitors wait for approvals
* **Audit Readiness:** Continuous compliance evidence generated automatically

**Risk Mitigation:**

* Eliminated human error in production deployments
* Prevented security vulnerabilities from reaching customers
* Ensured consistent security standards across all deployments
* Created complete audit trails for compliance requirements

== Assessment and Reflection

Take a moment to consider these questions about your workshop experience:

* **Process Transformation:** How does this automated approach compare to traditional deployment processes in your organization?

* **Security Integration:** What security capabilities are now automatically included that would typically require manual configuration and review?

* **Business Impact:** How would this level of automation affect your organization's ability to respond to market demands and competitive pressures?

* **Operational Excellence:** What operational benefits would your platform and security teams gain from this approach?

* **Implementation Planning:** What would be the first steps to implement similar capabilities in your organization?

== Next Steps and Advanced Topics

=== Recommended Follow-up Activities

**For Technical Teams:**

* Explore Enterprise Contract policy customization for your organization's requirements
* Investigate integration with existing security scanning tools
* Review GitOps repository structure and branching strategies
* Examine monitoring and alerting integration options

**For Business Leaders:**

* Calculate potential ROI based on deployment time reduction and risk mitigation
* Plan organizational change management for DevOps transformation
* Consider compliance requirements and audit trail benefits
* Evaluate competitive advantages of faster time-to-market

=== Optional Demonstration Enhancements

The following demonstrations can further illustrate enterprise transformation capabilities:

* **Security Failure Simulation:** Modify Enterprise Contract policies to demonstrate automatic pipeline failure when security requirements aren't met
* **Image Registry Exploration:** Display Quay registry showing production-tagged images and security scan results
* **Argo CD Monitoring:** Demonstrate real-time GitOps synchronization and deployment status
* **Policy Customization:** Show how Enterprise Contract policies can be customized for specific organizational requirements

== Congratulations on Completing the Production Workshop!

You've successfully experienced the future of enterprise application deployment — secure, automated, and business-focused* This represents a fundamental shift from traditional deployment practices to modern, risk-mitigated automation that enables competitive advantage through technology.

**Key Achievements:**

* Implemented end-to-end automated production deployment
* Experienced enterprise-grade security validation
* Observed GitOps-based deployment automation
* Understood the business value of supply chain security

This production workshop demonstrates how Red Hat Advanced Developer Suite enables organizations to achieve both security excellence and business velocity simultaneously.